{% extends 'base.html' %}

{% block title %}Dashboard Admin{% endblock %}

{% block content %}
<h1>Dashboard Admin</h1>

<h2>Informations personnelles</h2>
    <table border="1" cellpadding="5" cellspacing="0">
  <tr>
    <th>Nom</th>
    <th>Prenom</th>
    <th>Email</th>
  </tr>
        <tr>
    <td>{{ current_user.nom }}</td>
    <td>{{ current_user.prenom }}</td>
    <td>{{ current_user.email }}</td>
</tr>
        </table>
            <form method="post" action="{{ url_for('admin.admin_dashboard') }}">
            {{ update_admin_form.hidden_tag() }}


                {{ update_admin_form.update_admin(value="update_admin")}}
                {{ update_admin_form.update_info_user_id(value=current_user.id|string)}}
<!--                    {{ update_admin_form.update_info_user_id() }}-->

<!--                <input type="hidden" name="update_admin" value="1">-->
<!--                <input type="hidden" name="user_id" value="{{ current_user.id }}">-->


                {{ update_admin_form.new_nom.label }} {{ update_admin_form.new_nom() }}
                {{ update_admin_form.new_prenom.label }} {{ update_admin_form.new_prenom() }}
                {{ update_admin_form.new_email.label }} {{ update_admin_form.new_email() }}

                {{ update_admin_form.submit() }}

<!--              <label>Nouveau Email:</label><br>-->
<!--              <input type="email" name="new_email"><br>-->

<!--              <label>Nouveau Nom:</label><br>-->
<!--              <input type="text" name="new_nom"><br>-->

<!--              <label>Nouveau Prenom:</label><br>-->
<!--              <input type="text" name="new_prenom"><br><br>-->

<!--              <button type="submit">Modifier</button>-->
            </form>
<br>
<hr>

<h2>Créer un utilisateur</h2>

<form method="POST" action="{{ url_for('admin.admin_dashboard') }}">
    {{ create_user_form.hidden_tag() }}

    {{ create_user_form.create_user(value="create_user")}}

    {{ create_user_form.nom.label }} {{ create_user_form.nom() }}
    {{ create_user_form.prenom.label }} {{ create_user_form.prenom() }}
    {{ create_user_form.email.label }} {{ create_user_form.email() }}

    {{ create_user_form.password.label }} {{ create_user_form.password() }}
    {{ create_user_form.confirm_password.label }} {{ create_user_form.confirm_password() }}

    {{ create_user_form.role.label }} {{ create_user_form.role() }}

    {{ create_user_form.submit() }}


<!--  <input type="hidden" name="create_user" value="1">-->
<!--  <label>Email:</label><br>-->
<!--  <input type="email" name="email" required><br>-->
<!--  <label>Nom:</label><br>-->
<!--  <input type="text" name="nom" required><br>-->
<!--  <label>Prenom:</label><br>-->
<!--  <input type="text" name="prenom" required><br>-->
<!--  <label>Mot de passe:</label><br>-->
<!--  <input type="password" name="password" required><br>-->
<!--  <label>Rôle:</label><br>-->
<!--  <select name="role" required>-->
<!--    <option value="utilisateur">Utilisateur</option>-->
<!--    <option value="employe">Employé</option>-->
<!--    <option value="admin">Admin</option>-->
<!--  </select><br><br>-->
<!--  <button type="submit">Créer</button>-->
</form>

<hr>

<h2>Liste des utilisateurs</h2>
<form method="GET" action="{{ url_for('admin.admin_dashboard') }}">

    {{ admin_recherche_form.hidden_tag() }}

    {{ admin_recherche_form.query() }}
    {{ admin_recherche_form.submit() }}

<!--    <input type="text" name="q" placeholder="Rechercher un utilisateur" value="{{ search_query }}">-->
<!--  <button type="submit">Rechercher</button>-->
  {% if search_query %}
    <a href="{{ url_for('admin.admin_dashboard') }}">Réinitialiser</a>
  {% endif %}
</form>
<br>
<table border="1" cellpadding="5" cellspacing="0">
  <tr>
    <th>ID</th>
    <th>Nom</th>
    <th>Prenom</th>
    <th>Email</th>
    <th>Rôle</th>
    <th>Changer rôle</th>
    <th>Supprimer</th>
  </tr>
  {% for user in users %}
  <tr>
    <td>{{ user.id }}</td>
    <td>{{ user.nom }}</td>
    <td>{{ user.prenom }}</td>
    <td>{{ user.email }}</td>
    <td>{{ user.role }}</td>
    <td>
      <form method="POST" action="{{ url_for('admin.admin_dashboard') }}" style="display:inline;">
          {{ update_role_form.hidden_tag() }}

          {{ update_role_form.update_role(value="update_role")}}
          {{ update_role_form.update_role_user_id(value=user.id|string) }}

          {{ update_role_form.new_role.label }} {{ update_role_form.new_role() }}
          {{ update_role_form.submit() }}
<!--        <input type="hidden" name="update_role" value="1">-->
<!--        <input type="hidden" name="user_id" value="{{ user.id }}">-->
<!--        <select name="role">-->
<!--          <option value="utilisateur" {% if user.role == 'utilisateur' %}selected{% endif %}>Utilisateur</option>-->
<!--          <option value="employe" {% if user.role == 'employe' %}selected{% endif %}>Employé</option>-->
<!--          <option value="admin" {% if user.role == 'admin' %}selected{% endif %}>Admin</option>-->
<!--        </select>-->
<!--        <button type="submit">Mettre à jour</button>-->
      </form>
    </td>
    <td>
      {% if user.id != current_user.id %}
      <form method="POST" action="{{ url_for('admin.admin_dashboard') }}" style="display:inline;" onsubmit="return confirm('Confirmer la suppression ?');">
          {{ delete_user_form.hidden_tag() }}

          {{ delete_user_form.delete_user(value="delete_user")}}
          {{ delete_user_form.delete_user_user_id(value=user.id|string) }}


          {{ delete_user_form.delete(class="btn btn-danger") }}
<!--        <input type="hidden" name="delete_user" value="1">-->
<!--        <input type="hidden" name="user_id" value="{{ user.id }}">-->
<!--        <button type="submit" style="color:red;">Supprimer</button>-->
      </form>
      {% endif %}
    </td>
  </tr>
  {% endfor %}
</table>

<br>
<hr>
<br>


<table border="1" cellpadding="5" cellspacing="0">
  <tr>
    <th>ID</th>
    <th>Nom de l'offre (type_offre)</th>
    <th>Nombre de personne maximum</th>
    <th>Prix</th>
    <th>Billet restant</th>
    <th>Billet vendu</th>
  </tr>
  {% for offre in offres %}
  <tr>
    <td>{{ offre.id }}</td>
    <td>{{ offre.type_offre }}</td>
    <td>{{ offre.nombre_personne }} personne(s)</td>
    <td>{{ offre.prix }} euro</td>
    <td>{{ offre.bi_restant }}</td>
    <td>{{ offre.bi_vendu }}</td>
  </tr>
  {% endfor %}
</table>


<br>
<hr>

<h2>Mes Billets</h2>
<ul>
  {% for ticket in tickets %}
    <li>
      <a href="{{ url_for('admin.ticket_detail', ticket_id=ticket.id) }}" target="_blank">
        Voir mon ticket n°{{ ticket.id }} - {{ ticket.offre.type_offre }}
      </a>
    </li>
  {% else %}
    <li>Aucun billet acheté.</li>
  {% endfor %}
</ul>

{% endblock %}
